# Aidan Cole LARP 745 Final Project 
# Calculating Sea Level Rise Vulnerability in Los Angeles, CA Using Machine Learning 

# load libraries 
library(tidyverse)
library(tidycensus)
library(tigris)
library(tmap)
library(sf)
library(kableExtra)
library(tigris)
library(ggmap)
library(raster)
library(stargazer)
library(caTools)
library(caret)
library(spdep)
library(mapboxapi)


# ---- Load Styling options -----

mapTheme <- function(base_size = 12) {
  theme(
    text = element_text( color = "black"),
    plot.title = element_text(size = 16,colour = "black"),
    plot.subtitle=element_text(face="italic"),
    plot.caption=element_text(hjust=0),
    axis.ticks = element_blank(),
    panel.background = element_blank(),axis.title = element_blank(),
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=2),
    strip.text.x = element_text(size = 14))
}

plotTheme <- function(base_size = 12) {
  theme(
    text = element_text( color = "black"),
    plot.title = element_text(size = 16,colour = "black"),
    plot.subtitle = element_text(face="italic"),
    plot.caption = element_text(hjust=0),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line("grey80", size = 0.1),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=2),
    strip.background = element_rect(fill = "grey80", color = "white"),
    strip.text = element_text(size=12),
    axis.title = element_text(size=12),
    axis.text = element_text(size=10),
    plot.background = element_blank(),
    legend.background = element_blank(),
    legend.title = element_text(colour = "black", face = "italic"),
    legend.text = element_text(colour = "black", face = "italic"),
    strip.text.x = element_text(size = 14)
  )
}

# Load Quantile break functions

qBr <- function(df,variable,rnd) {
  if (missing(rnd)) {
    as.character(quantile(round(df[[variable]],0),
                          c(.01,.2,.4,.6,.8), na.rm=T))
  } else if (rnd == FALSE | rnd == F) {
    as.character(formatC(quantile(df[[variable]],
                                  c(.01,.2,.4,.6,.8), na.rm=T), digits = 3))
  }
}

q5 <- function(variable) {as.factor(ntile(variable, 5))}

# Load hexadecimal color palette

palette5 <- c("#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac")

# load sealevel data 

boulder <- st_read("/Users/aidanpcole/Desktop/code/studentData.geojson",crs = 'ESRI:102254')%>%
  filter(MUSA_ID!=8735)

# load census data and filter to wanted variables 

census_api_key("ea7bd3babfc0da6a4caa6d2536b66403a88929f2", overwrite = TRUE) 

#keep all variables in first three rows and columns
#variables in rows 4 and 5 are for males over age of 65 
#variables in 6 and 7 are for females over age of 65 
#first two in row 8 are males under 5 and females under 5 
#third in row 8 is start of male from 18 to 65 all the way to row 12 B01001_019E
#row 13 female 18 to 65 to first variable in row 17 to B01001_043E
#second two variables in row 17 are male 18-34, 35-64 with disability 
#first two variables in row 18 are female 18-34, 35-64 with disability 
# last variable in row 18 is per capita income in last 12 months, B19301_001E
# first variable row 19 is total unemployed, second and third male mental dis 18-64 
# first andsecond row in 20 is female mental dis 18-64, third is # of people using public transportation to get to work C08111_016E
# first in row 21 # of people using car to get to work, # w no vehicle, # under 6 yrs living with one parent C23008_008E
# first in row 22 # 17 w one parent, second is total work force, third is institutionalized group quarters B26103_003E
# first row 23 spanish b bad english, second other language b bad english, immigrant turned citizen after 5 years B05001_005E
# first row 24 non citizen, second is mobility (moved within LA county), renter occupied B25036_013E
# first row 25 owner occupied, second is total housing units, median age B01002_001E
# row 26 is male age 5-17, row 27 is female age 5-17
tracts19 <- 
  get_acs(geography = "tract", variables = c("B01003_001E","B02001_002E","B02001_003E",
                                             "B03002_003E","B02001_005E","B19013_001E",
                                             "B15002_015E","B15002_032E","B06012_002E",
                                             "B01001_020E","B01001_021E","B01001_022E",
                                             "B01001_023E","B01001_024E","B01001_025E",
                                             "B01001_044E","B01001_045E","B01001_046E",
                                             "B01001_047E","B01001_048E","B01001_049E",
                                             "B01001_003E","B01001_027E","B01001_007E",
                                             "B01001_008E","B01001_009E","B01001_010E",
                                             "B01001_011E","B01001_012E","B01001_013E",
                                             "B01001_014E","B01001_015E","B01001_016E",
                                             "B01001_017E","B01001_018E","B01001_019E",
                                             "B01001_031E","B01001_032E","B01001_033E",
                                             "B01001_034E","B01001_035E","B01001_036E",
                                             "B01001_037E","B01001_038E","B01001_039E",
                                             "B01001_040E","B01001_041E","B01001_042E",
                                             "B01001_043E","B18101_010E","B18101_013E",
                                             "B18101_029E","B18101_032E","B19301_001E",
                                             "B23025_005E","B18104_007E","B18104_010E",
                                             "B18104_023E","B18104_026E","B08006_008E",
                                             "B08006_002E","B08014_002E","B05009_013E",
                                             "B05009_031E","B08006_001E","B26001_001E",
                                             "B06007_005E","B06007_008E","B05001_005E",
                                             "B05001_006E","B07001PR_050E","B25036_013E",
                                             "B25036_002E","B25001_001E","B01002_001E",
                                             "B01001_004E","B01001_005E","B01001_006E",
                                             "B01001_028E","B01001_029E","B01001_030E"), 
          year=2019, state=06, county=037, geometry=T, output='wide') %>%
  st_transform('EPSG:3498') %>%
  rename(TotalPop = B01003_001E, 
         Whites = B02001_002E,
         FemaleBachelors = B15002_032E, 
         MaleBachelors = B15002_015E,
         MedHHInc = B19013_001E, 
         AfricanAmericans = B02001_003E,
         Latinos = B03002_003E,
         Asians = B02001_005E,
         TotalPoverty = B06012_002E,
         MaleUnder5 = B01001_003E,
         FemaleUnder5 = B01001_027E,
         Male6566 = B01001_020E,
         Male6769 = B01001_021E,
         Male7074 = B01001_022E,
         Male7579 = B01001_023E,
         Male8084 = B01001_024E,
         Male85Up = B01001_025E,
         Female6566 = B01001_044E,
         Female6769 = B01001_045E,
         Female7074 = B01001_046E,
         Female7579 = B01001_047E,
         Female8084 = B01001_048E,
         Female85Up = B01001_049E,
         Male1819 = B01001_007E,
         Male20 = B01001_008E,
         Male21 = B01001_009E,
         Male2224 = B01001_010E,
         Male2529 = B01001_011E,
         Male3034 = B01001_012E,
         Male3539 = B01001_013E,
         Male4044 = B01001_014E,
         Male4549 = B01001_015E,
         Male5054 = B01001_016E,
         Male5559 = B01001_017E,
         Male6061 = B01001_018E,
         Male6264 = B01001_019E,
         Female1819 = B01001_031E,
         Female20 = B01001_032E,
         Female21 = B01001_033E,
         Female2224 = B01001_034E,
         Female2529 = B01001_035E,
         Female3034 = B01001_036E,
         Female3539 = B01001_037E,
         Female4044 = B01001_038E,
         Female4549 = B01001_039E,
         Female5054 = B01001_040E,
         Female5559 = B01001_041E,
         Female6061 = B01001_042E,
         Female6264 = B01001_043E,
         Male1834PhyDis = B18101_010E,
         Male3564PhyDis = B18101_013E,
         Female1834PhyDis = B18101_029E,
         Female3564PhyDis = B18101_032E,
         PerCapInc = B19301_001E,
         TotalUnemployed = B23025_005E,
         Male1834MenDis = B18104_007E,
         Male3564MenDis = B18104_010E,
         Female1834MenDis = B18104_023E,
         Female3564MenDis = B18104_026E,
         PublicTrans = B08006_008E,
         CarTrans = B08006_002E,
         NoVehicle = B08014_002E,
         OneParent6 = B05009_013E,
         OneParent17 = B05009_031E,
         TotalWorkers = B08006_001E,
         Institutionalized = B26001_001E,
         SpanNoEng = B06007_005E,
         LangNoEng = B06007_008E,
         ImmNaturalized = B05001_005E,
         ImmNonCitizen = B05001_006E,
         Mobility = B07001PR_050E,
         OwnerOccupied = B25036_002E,
         RenterOccupied = B25036_013E,
         TotalHousingUnits = B25001_001E,
         MedianAge = B01002_001E,
         Male59 = B01001_004E,
         Male1014 = B01001_005E,
         Male1517 = B01001_006E,
         Female59 = B01001_028E,
         Female1014 = B01001_029E,
         Female1517 = B01001_030E) %>%
  dplyr::select(-NAME, -starts_with("B")) %>%
  mutate(pctWhite = ifelse(TotalPop > 0, Whites / TotalPop,0),
         pctBlack = ifelse(TotalPop > 0, AfricanAmericans / TotalPop,0),
         pctLatino = ifelse(TotalPop > 0, Latinos / TotalPop,0),
         pctAsian = ifelse(TotalPop > 0, Asians / TotalPop,0),
         pctBachelors = ifelse(TotalPop > 0, ((FemaleBachelors + MaleBachelors) / TotalPop),0),
         pctPoverty = ifelse(TotalPop > 0, TotalPoverty / TotalPop, 0),
         year = "2019",
         pctUnder5 = ifelse(TotalPop > 0, ((MaleUnder5 + FemaleUnder5) / TotalPop),0),
         pctOver65 = ifelse(TotalPop > 0, ((Male6566 + Male6769 + Male7074 + Male7579 + Male8084 + Male85Up + Female6566 + Female6769 + Female7074 + Female7579 + Female8084 + Female85Up) / TotalPop),0),
         Males18To65 = ifelse(TotalPop > 0, (Male1819 + Male20 + Male21 + Male2224 + Male2529 + Male3034 + Male3539 + Male4044 + Male4549 + Male5054 + Male5559 + Male6061 + Male6264),0),
         Females18To65 = ifelse(TotalPop > 0, (Female1819 + Female20 + Female21 + Female2224 + Female2529 + Female3034 + Female3539 + Female4044 + Female4549 + Female5054 + Female5559 + Female6061 + Female6264),0),
         Total18To65 = ifelse(TotalPop > 0, (Males18To65 + Females18To65),0),
         Total18To65PHY = ifelse(TotalPop > 0, (Male1834PhyDis + Male3564PhyDis + Female1834PhyDis + Female3564PhyDis),0),
         Total18To65MENTAL = ifelse(TotalPop > 0, (Male1834MenDis + Male3564MenDis + Female1834MenDis + Female3564MenDis),0),
         pctPHY = ifelse(TotalPop > 0, (Total18To65PHY / Total18To65),0),
         pctMENTAL = ifelse(TotalPop > 0, (Total18To65MENTAL / Total18To65),0),
         SinglePar_H = ifelse(TotalPop > 0, (OneParent6 + OneParent17),0),
         pctSinglePar = ifelse(TotalPop > 0, (SinglePar_H / (MaleUnder5 + Male59 + Male1014 + Male1517 + FemaleUnder5 + Female59 + Female1014 + Female1517)),0),
         pctRented = ifelse(TotalHousingUnits > 0, (RenterOccupied / TotalHousingUnits),0),
         pctInstit = ifelse(TotalPop > 0, (Institutionalized / TotalPop),0),
         pctPubTrans = ifelse(TotalWorkers > 0, (PublicTrans / TotalWorkers),0),
         pctCarTrans = ifelse(TotalWorkers > 0, (CarTrans / TotalWorkers),0),
         pctCarless = ifelse(TotalPop > 0, (NoVehicle / TotalPop),0),
         pctPoorEnglish = ifelse(TotalPop > 0, ((SpanNoEng + LangNoEng) / TotalPop),0),
         pctDisplacment = ifelse(TotalPop > 0, (Mobility / TotalPop),0),
         pctImmigrants = ifelse(TotalPop > 0, (ImmNonCitizen / TotalPop),0),
         pctPriorImmigrants = ifelse(TotalPop > 0, (ImmNaturalized / TotalPop),0)) %>%
  dplyr::select(-Whites, -FemaleBachelors, -MaleBachelors, -TotalPoverty, -AfricanAmericans, -Asians, -Latinos,
                -MaleUnder5, -FemaleUnder5, -Male6566, -Male6769, -Male7074, -Male7579, -Male8084, -Male85Up, -Female6566,
                -Female6769, -Female7074, -Female7579, -Female8084, -Female85Up, - Male1819, -Male20, -Male21, 
                -Male2224, -Male2529, -Male3034, -Male3539, -Male4044, -Male4549, -Male5054, -Male5559, -Male6061, -Male6264,
                -Female1819, -Female20, -Female21, -Female2224, -Female2529, -Female3034, -Female3539, -Female4044, -Female4549, 
                -Female5054, -Female5559, -Female6061, -Female6264, -Male1834PhyDis, -Male3564PhyDis, -Female1834PhyDis,
                -Female3564PhyDis, -OneParent6, -OneParent17, -RenterOccupied, 
                -OwnerOccupied, -PublicTrans, -CarTrans, -Mobility, -Males18To65, -Females18To65,
                -Total18To65PHY, -Total18To65MENTAL, -Male59, -Male1014, -Male1517, -Female59, -Female1014, -Female1517, -NoVehicle,
                -SpanNoEng, -LangNoEng, -SinglePar_H, -pctDisplacment, -Male1834MenDis, -Male3564MenDis, -Female1834MenDis, -Female3564MenDis)


LosAngelesBoundary <- 
  st_read("/Users/Aidan/Desktop/code2/LARPFINAL/City Boundary of Los Angeles.geojson") %>%
  st_transform('EPSG:3498') 


# visualize it 
# Plot median household income per tract 

tracts19na <- na.omit(tracts19)

filteredTracts = st_filter(tracts19na, LosAngelesBoundary, .pred = st_intersects)
filteredTracts <- filteredTracts %>%
  mutate(Tract_N = substring(filteredTracts$GEOID, nchar(as.character(filteredTracts$GEOID)) - 5))


ggplot() +
  geom_sf(data=st_union(filteredTracts)) +
  geom_sf(data=filteredTracts,aes(fill=q5(MedHHInc)))+
  scale_fill_manual(values=palette5,
                    labels=qBr(filteredTracts,"MedHHInc"),
                    name="Median Household Income\n(Quintile Breaks)")+
  labs(title="Median Household Income", 
       subtitle="Los Angeles, CA", 
       caption="Figure 1") +
  mapTheme()



# DATA WRANGLINGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG

# Historic/Cultural Sites 
# Read in the CSV data and store it in a variable 
HisAddress <- read.csv("/Users/Aidan/Desktop/code2/LARPFINAL/Cultural_Centers__Theaters__Historic_Sites__and_Galleries__Location_and_Contact_Information.csv")

# take (lat,lon) out of ADDRESS column
HisAddress$ADDRESS<-gsub("^.*\\(","",HisAddress$ADDRESS)
HisAddress$ADDRESS<-gsub(")", "", HisAddress$ADDRESS)
HisLatLon <- HisAddress %>%
  mutate(X = gsub("^(.*?),.*", "\\1", HisAddress$ADDRESS),
         Y = gsub(".*,","",HisAddress$ADDRESS))

# Convert lat/long to a sf
His_sf <- HisLatLon %>%
  st_as_sf(coords = c("Y","X"), crs=4326)%>%
  st_transform('EPSG:3498') 

# Example visualization to make sure it worked 
ggplot() + 
  geom_sf(data=st_union(filteredTracts)) +
  geom_sf(data=His_sf, 
          show.legend = "point", size= 2) +
  labs(title="Historical/Cultural Sites", 
       subtitle="Los Angeles, CA", 
       caption="Figure 2") +
  mapTheme()

# Emergency Preparedness Locations 
# Read in the CSV data and store it in a variable 
EmergencyLocations <- read.csv("/Users/Aidan/Desktop/code2/LARPFINAL/Emergency_Preparedness_Locations_-_2018.csv")

# Convert lat/long to a sf 
Emergency_sf <- EmergencyLocations %>%
  st_as_sf(coords = c("Longitude","Latitude"), crs=4326)%>%
  st_transform('EPSG:3498')

# Example visualization to make sure it worked 
ggplot() + 
  geom_sf(data=st_union(filteredTracts)) +
  geom_sf(data=Emergency_sf, 
          show.legend = "point", size= 2) +
  labs(title="Emergency Preparedness Sites", 
       subtitle="Los Angeles, CA", 
       caption="Figure 3") +
  mapTheme()


# Hospital and Urgent Care Locations 
# Read in CSV and store as variable 
HospitalLocations <- read.csv("/Users/Aidan/Desktop/code2/LARPFINAL/los-angeles-county-hospitals-and-medical-centers.csv")

# Convert lat/long to a sf 
Hospitals_sf <- HospitalLocations %>%
  st_as_sf(coords = c("longitude","latitude"), crs=4326)%>%
  st_transform('EPSG:3498')

# filter out hospitals not in LA 

filteredHospitals = st_filter(Hospitals_sf, filteredTracts, .pred = st_intersects)


# Example visualization to make sure it worked 
ggplot() + 
  geom_sf(data=st_union(filteredTracts)) +
  geom_sf(data=filteredHospitals, 
          show.legend = "point", size= 2) +
  labs(title="Hospitals and Urgent Care Sites", 
       subtitle="Los Angeles, CA", 
       caption="Figure 4") +
  mapTheme()





# Homeless Count by Census tract 
HomelessCount <- 
  st_read("/Users/Aidan/Desktop/code2/LARPFINAL/Homeless_Count_Los_Angeles_County_2019.geojson") %>%
  st_transform('EPSG:3498') 

# remove tracts not in city of LA
filteredHomeless = st_filter(HomelessCount, LosAngelesBoundary, .pred = st_within)

# combine homeless count with tracts 
Homeless_and_Tracts <- merge(filteredTracts, st_drop_geometry(filteredHomeless), by="Tract_N", all.filteredTracts=TRUE) %>%
  dplyr::select(-FID, -SPA, -CD, -Detailed_1, -Detailed_N, -SD, -Tract_1, -Year_1, -unincorpor,
                -SHAPE_Length, -SHAPE_Area, -totUnshe_1, -totShelt_1, -u_dens, -s_dens)


# Waste Site Locations 
PollutionLocations <- read.csv("/Users/Aidan/Desktop/code2/LARPFINAL/CalEnviroScreen_4.0Excel_ADA_D1_2021.csv") 

# Convert lat/long to a sf 
Pollution_sf <- PollutionLocations %>%
  st_as_sf(coords = c("Longitude","Latitude"), crs=4326)%>%
  st_transform('EPSG:3498')


# filter to only LA 
filteredPollution = st_filter(Pollution_sf, Homeless_and_Tracts, .pred = st_within)

Homeless_and_Tracts$GEOID <- gsub("^0+", "", Homeless_and_Tracts$GEOID)
# combine homeless count with tracts 
Pollution_and_Tracts <- merge(Homeless_and_Tracts, st_drop_geometry(filteredPollution), by.x="GEOID", by.y="Census.Tract", all.Homeless_and_Tracts=TRUE) %>%
  dplyr::select(-Total.Population, -ZIP, -California.County, -Nearby.City...to.help.approximate.location.only.,
                -DRAFT.CES.4.0.Percentile.Range, -Ozone, -Ozone.Pctl, -PM2.5, -Diesel.PM, -Drinking.Water, 
                -Lead, -Lead.Pctl, -Pesticides, -Pesticides.Pctl, -Tox..Release, -Traffic, -Traffic.Pctl, -Cleanup.Sites,
                -Cleanup.Sites.Pctl, -Groundwater.Threats, -Haz..Waste, -Imp..Water.Bodies, -Solid.Waste,
                -Low.Birth.Weight, -Low.Birth.Weight.Pctl, -Cardiovascular.Disease, -Cardiovascular.Disease.Pctl,
                -TotalUnemployed, -TotalWorkers, -Institutionalized, -Total18To65)


names(Pollution_and_Tracts)[names(Pollution_and_Tracts) == 'totPeopl_1'] <- "TotalHomeless"
names(Pollution_and_Tracts)[names(Pollution_and_Tracts) == 't_dens'] <- "HomelessDensity"

SocialTracts <- na.omit(Pollution_and_Tracts)

ggplot() +
  geom_sf(data=st_union(SocialTracts)) +
  geom_sf(data=SocialTracts,aes(fill=q5(Pop..Char..Pctl)))+
  scale_fill_manual(values=palette5,
                    labels=qBr(SocialTracts,"Pop..Char..Pctl"),
                    name="Population Characteristics Percentile\n(Quintile Breaks)")+
  labs(title="Population Characteristics Percentile", 
       subtitle="Los Angeles, CA", 
       caption="Figure 4") +
  mapTheme()


MapToken = "pk.eyJ1IjoiYWlkYW5wY29sZSIsImEiOiJjbDEzcmwwY2oxeGd4M2tydHJvNmtidjMyIn0.DJrO8ZYZuhECivpDEs2pAA"
mb_access_token(MapToken,install=TRUE)

tm_shape(SocialTracts) + 
  tm_polygons()

hennepin_tiles <- get_static_tiles(
  location = SocialTracts,
  zoom = 10,
  style_id = "light-v9",
  username = "mapbox"
)

# Social and Environmental Vulnerability Map 
tm_shape(hennepin_tiles) + 
  tm_rgb() + 
  tm_shape(SocialTracts) + 
  tm_polygons(col = "DRAFT.CES.4.0.Percentile",
              style = "jenks",
              n = 5,
              palette = "Purples",
              title = "CalEnviroScreen 4.0 Social Vulnerability Index",
              alpha = 0.7) +
  tm_layout(title = "Social Vulnerability Index\nby Census tract",
            legend.outside = TRUE,
            fontfamily = "Verdana") + 
  tm_scale_bar(position = c("left", "bottom")) + 
  tm_compass(position = c("right", "top")) + 
  tm_credits("(c) Mapbox, OSM    ", 
             bg.color = "white",
             position = c("RIGHT", "BOTTOM"))



RedLined <- 
  st_read("/Users/Aidan/Desktop/code2/LARPFINAL/CALosAngeles1939.geojson") %>%
  st_transform('EPSG:3498') 

# Filter to only C and D grade districts
RedLinedDistricts <- filter(RedLined, holc_grade=="C" | holc_grade=="D")

# filter districts to only those within LA 
filteredRedLined = st_filter(RedLinedDistricts, SocialTracts, .pred = st_intersects)


allTracts.group <- 
  rbind(
    st_centroid(SocialTracts)[filteredRedLined,] %>%
      st_drop_geometry() %>%
      left_join(SocialTracts) %>%
      st_sf() %>%
      mutate(Redlined = "Redlined"),
    st_centroid(SocialTracts)[filteredRedLined, op = st_disjoint] %>%
      st_drop_geometry() %>%
      left_join(SocialTracts) %>%
      st_sf() %>%
      mutate(Redlined = "Non-Redlined"))



allTracts.group <- na.omit(allTracts.group)

ggplot() +
  geom_sf(data=st_union(allTracts.group)) +
  geom_sf(data=allTracts.group,aes(fill=Redlined))+
  labs(title="Redlined Neighborhoods", 
       subtitle="Los Angeles, CA", 
       caption="Figure 1") +
  mapTheme()











# Filter to only Boulder county 
bol_pov <- filter(inc_pov, County=="BOULDER")

#Change FIPS to GEOID 
colnames(bol_pov)[2] <- "GEOID"

# Edit GEOID column in tracts data to match that of bol_pov 
tracts19$GEOID <- as.character(tracts19$GEOID)
tracts19$GEOID <- gsub("^.{0,1}", "", tracts19$GEOID)

inc_pov_tracts <- merge(x = tracts19, y = bol_pov, by = "GEOID", all.x=TRUE) 

# HOSPITALSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
# Read in the hospital CSV data and store it in a variable 
hospAddress <- read.csv("/Users/aidanpcole/Desktop/code/Midterm508/us_hospital_locations.csv")

# Filter to only Boulder county 
bol_hosp <- filter(hospAddress, COUNTY=="BOULDER")

# Convert lat/long to a sf 
hosps_sf <- bol_hosp %>%
  st_as_sf(coords = c("LONGITUDE","LATITUDE"), crs=4326) %>%
  st_transform('ESRI:102254') #was 102253

# PLAYGROUNDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
# Read in playground geojson data and store it in a variable 
playgrounds <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/Playground_Sites_Points.geojson",crs = 4326) %>%
  dplyr::select(OBJECTID,NAME,geometry)%>%
  st_transform('ESRI:102254') #was 102253
# Delete NA values
playgrounds[is.na(playgrounds)] = 0 


# SCHOOLSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
schools <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/CDPHE_CDOE_School_Locations_and_District_Office_Locations.geojson",crs=4326)

# Filter to Boulder county 
bol_schools <- filter(schools, COUNTY=="BOULDER") %>%
  st_transform('ESRI:102254') #was 102253

# MUNICIPALITIESSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS  
munis <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/Municipalities.geojson",crs=4326)%>%
  st_transform('ESRI:102254') 

# Select wanted columns 
bol_munis <- munis %>%
  dplyr::select(ZONEDESC,ShapeSTArea,ShapeSTLength,geometry)

#--------bikes---------
bikes <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/Stolen_Bikes.geojson",crs=4326)%>%
  st_transform('ESRI:102254')

#get rid of na values
cleanbikes <- subset(bikes, OBJECTID!=2173514 & OBJECTID!=2172860)

#get just the geometries
bikes.sf <- subset(cleanbikes, select = -c(OBJECTID, REPORTNUM, NUMBIKESSTOLEN, STOLENVALUE, 
                                           NUMBIKESRECOVERED, RECOVEREDVALUE, ARREST, REPORTYEAR, 
                                           REPORTDATE, ADDRESS, CITY, DISTRICT, BEAT, Shape))

#-------Accessory dwelling units------------

dwellingUnits <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/Accessory_Dwelling_Units.geojson",crs=4326) %>%
  st_transform('ESRI:102254')


#---------police---------
police <- st_read("/Users/aidanpcole/Desktop/code/Midterm508/Police_Call_Data_28_Days.geojson")

#filter out violent/drug crimes
Dangerous.policecalls <-
  police %>%
  filter(str_detect(PROBLEM, "ASSAU|SAS|WEAP|SHOOT|SHOTS|NARCO|DTF|DOME|HARAS|ROBBE"))



